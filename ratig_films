WITH rating_4_to_4_9_tab AS (
    SELECT 'Рейтинг меньше 5' AS "Рейтинг", count(id_post) AS "Количество фильмов"        
    FROM tg.post_stat ps 
    WHERE text_post LIKE '%IMDb 4,0%'
       OR text_post LIKE '%IMDb 4,1%'
       OR text_post LIKE '%IMDb 4,2%'
       OR text_post LIKE '%IMDb 4,3%'
       OR text_post LIKE '%IMDb 4,4%'
       OR text_post LIKE '%IMDb 4,5%'
       OR text_post LIKE '%IMDb 4,6%'
       OR text_post LIKE '%IMDb 4,7%'
       OR text_post LIKE '%IMDb 4,8%'
       OR text_post LIKE '%IMDb 4,9%'
       OR text_post LIKE '%Кинопоиск 4,0%'
       OR text_post LIKE '%Кинопоиск 4,1%'
       OR text_post LIKE '%Кинопоиск 4,2%'
       OR text_post LIKE '%Кинопоиск 4,3%'
       OR text_post LIKE '%Кинопоиск 4,4%'
       OR text_post LIKE '%Кинопоиск 4,5%'
       OR text_post LIKE '%Кинопоиск 4,6%'
       OR text_post LIKE '%Кинопоиск 4,7%'
       OR text_post LIKE '%Кинопоиск 4,8%'
       OR text_post LIKE '%Кинопоиск 4,9%'
), 
rating_5_to_5_9_tab AS ( 
    SELECT 'Рейтинг 5-6' AS "Рейтинг", count(id_post) AS "Количество фильмов"    
    FROM tg.post_stat ps 
    WHERE text_post LIKE '%IMDb 5,0%'
       OR text_post LIKE '%IMDb 5,1%'
       OR text_post LIKE '%IMDb 5,2%'
       OR text_post LIKE '%IMDb 5,3%'
       OR text_post LIKE '%IMDb 5,4%'
       OR text_post LIKE '%IMDb 5,5%'
       OR text_post LIKE '%IMDb 5,6%'
       OR text_post LIKE '%IMDb 5,7%'
       OR text_post LIKE '%IMDb 5,8%'
       OR text_post LIKE '%IMDb 5,9%'
       OR text_post LIKE '%Кинопоиск 5,0%'
       OR text_post LIKE '%Кинопоиск 5,1%'
       OR text_post LIKE '%Кинопоиск 5,2%'
       OR text_post LIKE '%Кинопоиск 5,3%'
       OR text_post LIKE '%Кинопоиск 5,4%'
       OR text_post LIKE '%Кинопоиск 5,5%'
       OR text_post LIKE '%Кинопоиск 5,6%'
       OR text_post LIKE '%Кинопоиск 5,7%'
       OR text_post LIKE '%Кинопоиск 5,8%'
       OR text_post LIKE '%Кинопоиск 5,9%'
), 
rating_6_to_6_9_tab AS ( 
    SELECT 'Рейтинг 6-7' AS "Рейтинг", count(id_post) AS "Количество фильмов"        
    FROM tg.post_stat ps 
    WHERE text_post LIKE '%IMDb 6,0%'
       OR text_post LIKE '%IMDb 6,1%'
       OR text_post LIKE '%IMDb 6,2%'
       OR text_post LIKE '%IMDb 6,3%'
       OR text_post LIKE '%IMDb 6,4%'
       OR text_post LIKE '%IMDb 6,5%'
       OR text_post LIKE '%IMDb 6,6%'
       OR text_post LIKE '%IMDb 6,7%'
       OR text_post LIKE '%IMDb 6,8%'
       OR text_post LIKE '%IMDb 6,9%'
       OR text_post LIKE '%Кинопоиск 6,0%'
       OR text_post LIKE '%Кинопоиск 6,1%'
       OR text_post LIKE '%Кинопоиск 6,2%'
       OR text_post LIKE '%Кинопоиск 6,3%'
       OR text_post LIKE '%Кинопоиск 6,4%'
       OR text_post LIKE '%Кинопоиск 6,5%'
       OR text_post LIKE '%Кинопоиск 6,6%'
       OR text_post LIKE '%Кинопоиск 6,7%'
       OR text_post LIKE '%Кинопоиск 6,8%'    
       OR text_post LIKE '%Кинопоиск 6,9%'     
), 
rating_7_to_7_9_tab AS (
    SELECT 'Рейтинг 7-8' AS "Рейтинг", count(id_post) AS "Количество фильмов"        
    FROM tg.post_stat ps 
    WHERE text_post LIKE '%IMDb 7,0%'
       OR text_post LIKE '%IMDb 7,1%'
       OR text_post LIKE '%IMDb 7,2%'
       OR text_post LIKE '%IMDb 7,3%'
       OR text_post LIKE '%IMDb 7,4%'
       OR text_post LIKE '%IMDb 7,5%'
       OR text_post LIKE '%IMDb 7,6%'
       OR text_post LIKE '%IMDb 7,7%'
       OR text_post LIKE '%IMDb 7,8%'
       OR text_post LIKE '%IMDb 7,9%'
       OR text_post LIKE '%Кинопоиск 7,0%'
       OR text_post LIKE '%Кинопоиск 7,1%'
       OR text_post LIKE '%Кинопоиск 7,2%'
       OR text_post LIKE '%Кинопоиск 7,3%'
       OR text_post LIKE '%Кинопоиск 7,4%'
       OR text_post LIKE '%Кинопоиск 7,5%'
       OR text_post LIKE '%Кинопоиск 7,6%'
       OR text_post LIKE '%Кинопоиск 7,7%'
       OR text_post LIKE '%Кинопоиск 7,8%'
       OR text_post LIKE '%Кинопоиск 7,9%'
), 
rating_8_to_8_9_tab AS (
    SELECT 'Рейтинг 8-9' AS "Рейтинг", count(id_post) AS "Количество фильмов"        
    FROM tg.post_stat ps 
    WHERE text_post LIKE '%IMDb 8,0%'
       OR text_post LIKE '%IMDb 8,1%'
       OR text_post LIKE '%IMDb 8,2%'
       OR text_post LIKE '%IMDb 8,3%'
       OR text_post LIKE '%IMDb 8,4%'
       OR text_post LIKE '%IMDb 8,5%'
       OR text_post LIKE '%IMDb 8,6%'
       OR text_post LIKE '%IMDb 8,7%'
       OR text_post LIKE '%IMDb 8,8%'
       OR text_post LIKE '%IMDb 8,9%'
       OR text_post LIKE '%Кинопоиск 8,0%'
       OR text_post LIKE '%Кинопоиск 8,1%'
       OR text_post LIKE '%Кинопоиск 8,2%'
       OR text_post LIKE '%Кинопоиск 8,3%'
       OR text_post LIKE '%Кинопоиск 8,4%'
       OR text_post LIKE '%Кинопоиск 8,5%'
       OR text_post LIKE '%Кинопоиск 8,6%'
       OR text_post LIKE '%Кинопоиск 8,7%'
       OR text_post LIKE '%Кинопоиск 8,8%'
       OR text_post LIKE '%Кинопоиск 8,9%'
), 
rating_9_to_10_tab AS (
    SELECT 'Рейтинг 9-10' AS "Рейтинг", count(id_post) AS "Количество фильмов"        
    FROM tg.post_stat ps 
    WHERE text_post LIKE '%IMDb 9,0%'
       OR text_post LIKE '%IMDb 9,1%'
       OR text_post LIKE '%IMDb 9,2%'
       OR text_post LIKE '%IMDb 9,3%'
       OR text_post LIKE '%IMDb 9,4%'
       OR text_post LIKE '%IMDb 9,5%'
       OR text_post LIKE '%IMDb 9,6%'
       OR text_post LIKE '%IMDb 9,7%'
       OR text_post LIKE '%IMDb 9,8%'
       OR text_post LIKE '%IMDb 9,9%'
       OR text_post LIKE '%IMDb 10,0%'
       OR text_post LIKE '%Кинопоиск 9,0%'
       OR text_post LIKE '%Кинопоиск 9,1%'
       OR text_post LIKE '%Кинопоиск 9,2%'
       OR text_post LIKE '%Кинопоиск 9,3%'
       OR text_post LIKE '%Кинопоиск 9,4%'
       OR text_post LIKE '%Кинопоиск 9,5%'
       OR text_post LIKE '%Кинопоиск 9,6%'
       OR text_post LIKE '%Кинопоиск 9,7%'
       OR text_post LIKE '%Кинопоиск 9,8%'
       OR text_post LIKE '%Кинопоиск 9,9%'
       OR text_post LIKE '%Кинопоиск 10,0%'
)
SELECT * FROM (
    SELECT * FROM rating_4_to_4_9_tab
    UNION ALL
    SELECT * FROM rating_5_to_5_9_tab
    UNION ALL
    SELECT * FROM rating_6_to_6_9_tab
    UNION ALL
    SELECT * FROM rating_7_to_7_9_tab
    UNION ALL
    SELECT * FROM rating_8_to_8_9_tab
    UNION ALL
    SELECT * FROM rating_9_to_10_tab
) AS all_ratings
ORDER BY CAST(regexp_replace("Рейтинг", '[^0-9]', '', 'g') AS INT) DESC;

